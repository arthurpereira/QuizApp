<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:fb="http://www.facebook.com/2008/fbml">

    <f:view contentType="text/html" renderKitId="PRIMEFACES_MOBILE">
        <h:head>
            <title>QuizAPP</title>
            <meta name="viewport" content="width=device-width, user-scalable=no"/>
            <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
            <meta http-equiv="Pragma" content="no-cache" />
            <meta http-equiv="Expires" content="0" />
            <h:outputStylesheet library="css" name="style-responsive.css" />
            <h:outputStylesheet library="css" name="style-celular.css" />
            <link rel="stylesheet" href="#{request.contextPath}/resources/css/font-awesome.min.css" />
            <link rel="icon" href="#{request.contextPath}/resources/img/favicon.ico" type="image/ico" />
        </h:head>

        <h:body>
            <script src="resources/js/facebook.js"></script>
            
            <!-- PUSH -->
            <p:socket channel="/partida" onMessage="iniciarPartidaJS">
                <f:ajax event="message" render="panel-pergunta form-alternativas
                        panel-placar panel-partida-nao-iniciada"/>
                <p:ajax event="message" update="panel-partida-nao-iniciada" />
            </p:socket>
            <p:socket channel="/alternativa" onMessage="habilitarAlternativasJS"></p:socket>
            <p:socket channel="/pergunta" onMessage="mudarPerguntaJS"></p:socket>
            <p:socket channel="/resposta" onMessage="mostrarRespostaCertaJS"></p:socket>
            
            <!-- COMPONENTES EXTERNOS A PÁGINA -->
            <h:form>
                <p:remoteCommand name="iniciarPartida"
                                 actionListener="#{partidaBean.iniciarPartida()}"
                                 process="@this" update="panel-pergunta form-alternativas
                                 panel-placar panel-partida-nao-iniciada" />
                <p:remoteCommand name="habilitarAlternativas"
                                 actionListener="#{partidaBean.habilitarAlternativas()}"
                                 process="@this" update="form-alternativas" />
                <p:remoteCommand name="mudarPergunta"
                                 actionListener="#{partidaBean.mudarPergunta()}"
                                 process="@this" update="form-pergunta form-alternativas panel-placar" />
                <p:remoteCommand name="mostrarRespostaCerta"
                                 actionListener="#{partidaBean.mostrarRespostaCerta()}"
                                 process="@this" update="panel-pontuacao form-alternativas panel-placar" />
                <p:remoteCommand name="logarComFacebook"
                                 actionListener="#{partidaBean.logarComFacebook()}"
                                 update="panel-rodape" />
            </h:form>
            
            <!-- NOTIFICAÇÃO -->
            
            <h:form id="form-notificacao">
                <p:growl id="growl" for="default" showDetail="true" autoUpdate="true" sticky="false" life="3000"/>
            </h:form>
            
            <!-- DIALOGS -->
            
            <h:form id="form-dialog">
                <p:dialog widgetVar="dialog-confirma-resposta"
                          id="confirma-resposta"
                          header="VOCÊ TEM CERTEZA?"
                          draggable="false" resizable="false" modal="true">
                    <h:outputText value="Você escolheu a alternativa “#{partidaBean.alternativaEscolhida()}”. Você está certo disso?"
                                  id="txtConfirma" styleClass="textoDialog"/><br /><br />
                    <div>
                        <div style="width: 48%;float: right;">
                            <p:commandButton id="btn-confirma-sim" value="OK"
                                             actionListener="#{partidaBean.confirmaResposta()}"
                                             process="@this" styleClass="btn-confirma-sim"
                                             update="form-alternativas"
                                             onclick="PF('dialog-confirma-resposta').hide();"/>
                        </div>
                        <div style="width: 48%;float: left;">
                            <p:commandButton id="btn-confirma-nao" value="Cancelar"
                                             styleClass="btn-confirma-nao"
                                             onclick="PF('dialog-confirma-resposta').hide();"/>
                        </div>
                    </div>
                </p:dialog>
            </h:form>

            <!-- NAVEGAÇÃO -->
            <div id="div-fundo">

                <div id="div-fixo">
                    <div id="div-topo">
                        <span id="span-jogo" class="fa fa-question nav-ativo jogo">
                            <span class="span-tab-nome">Quiz</span>
                        </span>
                        <span id="span-placar" class="fa fa-trophy nav-inativo placar">
                            <span class="span-tab-nome">Placar</span>
                        </span>
                    </div>
                    
                    <div id="div-rodape">
                        <h:panelGroup id="panel-rodape">
                            <h:panelGroup id="panel-jogador" rendered="#{partidaBean.jogadorEstaLogado}">
                                <img id="img-foto-jogador"
                                     src="http://graph.facebook.com/#{partidaBean.jogador.facebook_id}/picture" />
                                <span id="span-nome-jogador">#{partidaBean.jogador.nome}</span>
                            </h:panelGroup>
                            <h:panelGroup id="panel-pontuacao" rendered="#{partidaBean.jogadorEstaLogado}">
                                <span id="span-pontuacao-jogador">#{partidaBean.getAcertos()}</span>
                            </h:panelGroup>
                        </h:panelGroup>
                        <div id="facebook-info" class="facebookinfo" style="display: none;">
                            <fb:login-button scope="public_profile,email"
                                             size="large"
                                             data-show-faces="false"
                                             data-auto-logout-link="false"
                                             onlogin="checkLoginState();">
                            </fb:login-button>
                        </div>
                    </div>
                </div>
                
                <h:panelGroup id="panel-partida-nao-iniciada">
                    <h:panelGroup rendered="#{!partidaBean.partidaIniciada}">
                        <div id="div-aguardando-jogo">
                            <span id="span-aguardando-jogo" class="fa fa-hourglass-half"></span>
                            <h2 id="h2-aguardando-jogo">Aguarde...</h2>
                            <p id="p-aguardando-jogo">O jogo já vai começar.</p>
                        </div>
                    </h:panelGroup>
                </h:panelGroup>
                
                <h:panelGroup id="panel-pergunta">
                    <h:panelGroup rendered="#{partidaBean.partidaIniciada}">
                        <div id="div-pergunta">
                            <h:form id="form-pergunta">
                                <p id="p-pergunta">#{partidaBean.perguntaAtual.texto}</p>
                            </h:form>
                            <h:form id="form-alternativas">
                                <p:dataGrid id="list-alternativas" columns="1" rows="4" var="alternativa"
                                            value="#{partidaBean.listaAlternativasPorPergunta}"
                                            rowIndexVar="rowIndex" layout="grid">
                                    <p:commandLink style="text-decoration: none !important;"
                                                   action="#{partidaBean.selecionaAlternativa(rowIndex)}"
                                                   rendered="#{partidaBean.liberaResponderPergunta
                                                               and partidaBean.alternativasHabilitadas}"
                                                   update=":form-dialog"
                                                   oncomplete="PF('dialog-confirma-resposta').show()">
                                        <div class="div-alternativa"
                                             style="#{partidaBean.retornaBackgroundColorAlternativa(rowIndex)}">
                                            <div class="div-indice-alternaviva">#{partidaBean.retornaLetraAlternativa(rowIndex)}</div>
                                            <p class="p-alternativa">#{alternativa.texto}</p>
                                        </div>
                                    </p:commandLink>
                                    <h:panelGroup rendered="#{!partidaBean.liberaResponderPergunta
                                                              or !partidaBean.alternativasHabilitadas}">
                                        <div class="div-alternativa"
                                             style="#{partidaBean.retornaBackgroundColorAlternativa(rowIndex)}">
                                            <div class="div-indice-alternaviva">#{partidaBean.retornaLetraAlternativa(rowIndex)}</div>
                                            <p class="p-alternativa">#{alternativa.texto}</p>
                                        </div>
                                    </h:panelGroup>
                                </p:dataGrid>
                            </h:form>
                        </div>
                    </h:panelGroup>
                </h:panelGroup>
                
                <h:panelGroup id="panel-placar">
                    <div id="div-placar" class="display-none">
                        <h:panelGroup rendered="#{!partidaBean.partidaIniciada}">
                            <p class="p-placar-vazio">O jogo ainda não começou.</p>
                        </h:panelGroup>
                        <h:panelGroup id="panel-lista-de-jogadores">
                            <p:dataGrid id="list-jogadores" columns="1" rows="10" var="jogador"
                                        value="#{partidaBean.listaJogadoresPorPartida}"
                                        rowIndexVar="rowIndex" layout="grid"
                                        emptyMessage="">
                                <table style="width: 100%;margin: -10px 0 -15px 0;table-layout: fixed;">
                                    <tr>
                                        <td style="width: 35px;text-align: center;">
                                            <span class="span-placar-colocacao">#{partidaBean.getColocacao(rowIndex)}º</span>
                                        </td>
                                        <td style="width:65px;text-align: center;">
                                            <img class="img-placar-foto-jogador" 
                                                 src="http://graph.facebook.com/#{jogador.jogador.facebook_id}/picture" />
                                        </td>
                                        <td>
                                            <p class="p-placar-jogador">#{jogador.jogador.nome}</p>
                                            <p class="p-placar-pontuacao">#{partidaBean.getAcertos(jogador.acertos)}</p>
                                        </td>
                                    </tr>
                                </table>
                                <hr class="hr-placar" />
                            </p:dataGrid>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>
                
                <div id="div-fim-do-jogo" class="container display-none">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="logo">
                                <img src="resources/img/quiz-app-logo.png" alt="Logo"/>
                                <h1>QuizAPP</h1>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="head-login">
                                <p class="obrigado">Obrigado por jogar!</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <section class="login">
                                <img class="logo-lades" src="resources/img/lades-logo.png" alt="Logo"/>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ARQUIVOS JS COLOCADOS NO FINAL PARA UM CARREGAMENTO MAIS RÁPIDO DA PÁGINA -->
            <script src="resources/js/main-celular.js"></script>
        </h:body>
    </f:view>
</html>

